"use strict";document.addEventListener("DOMContentLoaded",function(){var e=document.querySelectorAll(".sidenav"),t=document.querySelectorAll(".timepicker");M.Sidenav.init(e),M.Timepicker.init(t)});
"use strict";function LessonModule(){var e={errors:[],initXHR:function(e,t){if(t){var n=new XMLHttpRequest;return n.open(e,t,!0),n.setRequestHeader("Content-Type","application/json"),n}this.failure("","Ошибка запроса! Переданы не все аргументы.")},postRequest:function(e,t){if(e&&t){var n=this.initXHR("POST",e);n.addEventListener("load",function(){var e=JSON.parse(n.response);4==n.readyState&&200==n.status?this.prepareLessonCreate(e.docs):this.failure("Server error: ",e.msg)}.bind(this)),n.send(t)}},getRequest:function(e){if(e){var t=this.initXHR("GET",e);t.addEventListener("load",function(){var e=JSON.parse(t.response);4==t.readyState&&200==t.status?this.prepareLessonSelect(e.docs):this.failure("Server error: ",e.msg)}.bind(this)),t.send(null)}},putRequest:function(e,t){if(e&&t){var n=this.initXHR("PUT",e);n.addEventListener("load",function(){var e=JSON.parse(n.response);4==n.readyState&&200==n.status?this.prepareEditLesson(JSON.parse(t)):this.failure("Server error: ",e.msg)}.bind(this)),n.send(t)}},deleteRequest:function(e,t){if(e&&t){var n=this.initXHR("DELETE",e);n.addEventListener("load",function(){var e=JSON.parse(n.response);4==n.readyState&&200==n.status?this.prepareLessonDelete(t):this.failure("Server error: ",e.msg)}.bind(this)),n.send(null)}},failure:function(e,t){this.errors.push(t),this.showDialog(e,t)},showDialog:function(e,t){e?console.log(e,t):M.toast({html:t})}},t={checkInputs:function(e,t,n,s,i){if(e&&t&&n&&s&&i){if(!(s.length<=3&&i.length<=3))return!0;this.failure("","Название и описание должны содержать больше 3 символов!")}else this.failure("","Ошибка создания! Заполните все поля.")},lessonCreate:function(){var e=document.getElementById("tableLesson").getAttribute("value"),t=document.forms.createForm.querySelectorAll(".timepicker"),n=t[0].value,s=t[1].value,i=document.getElementById("titleCreate").value,r=document.getElementById("descCreate").value;if(this.checkInputs(e,n,s,i,r)){var o=JSON.stringify({id_date:e,time_start:n,time_end:s,title:i,desc:r});this.postRequest("/admin/lesson",o)}},prepareLessonCreate:function(e){e&&(this.clearCreateFormInputs(),this.addRowToTable(e))},lessonSelect:function(e){if(e){var t="/admin/lesson/select/".concat(e);this.getRequest(t)}},prepareLessonSelect:function(e){this.triggerForm(!0),document.forms.editForm.setAttribute("value",e._id)},lessonEdit:function(){var e=document.forms.editForm.getAttribute("value"),t=document.forms.editForm.querySelectorAll(".timepicker"),n=t[0].value,s=t[1].value,i=document.getElementById("titleEdit").value,r=document.getElementById("descEdit").value;if(this.checkInputs(e,n,s,i,r)){var o=JSON.stringify({_id:e,time_start:n,time_end:s,title:i,desc:r});this.putRequest("/admin/lesson",o)}},prepareEditLesson:function(e){e&&this.triggerForm(!1,e._id,e)},lessonDelete:function(e){if(e){var t="/admin/lesson/".concat(e);this.deleteRequest(t,e)}},prepareLessonDelete:function(e){document.getElementById("tr__".concat(e)).remove()},clearCreateFormInputs:function(){var e=document.forms.createForm.querySelectorAll(".timepicker");e[0].value="",e[1].value="",document.getElementById("titleCreate").value="",document.getElementById("descCreate").value=""},addRowToTable:function(e){if(e){var t=document.getElementById("tableLesson"),n=t.insertRow(t.length),s=n.insertCell(0),i=n.insertCell(1),r=n.insertCell(2),o=n.insertCell(3);n.setAttribute("id","tr__".concat(e._id)),s.setAttribute("id","time__".concat(e._id)),i.setAttribute("id","title__".concat(e._id)),r.setAttribute("id","desc__".concat(e._id)),s.innerHTML="".concat(e.time_start," - ").concat(e.time_end),i.innerHTML=e.title,r.innerHTML=e.desc,o.innerHTML=this.getOperation(e)}},getOperation:function(e){if(e){var t=e._id;return"<a onclick=\"lesson.lessonSelect('".concat(t,'\')" class="waves-effect waves-light btn"><i class="editLink small material-icons">edit</i></a>')+" "+"<a onclick=\"lesson.lessonDelete('".concat(t,'\')" class="waves-effect waves-light btn"><i class="small material-icons">delete</i></a>')}},triggerForm:function(e,t,n){var s=1<arguments.length&&void 0!==t?t:void 0,i=2<arguments.length&&void 0!==n?n:void 0,r=document.getElementsByClassName("__lesson"),o=document.getElementsByClassName("__lesson-edit");function a(e){for(var t=0;t<r.length;t++)r[t].style.display=e}switch(e){case!0:a("none"),o[0].style.display="block";break;case!1:o[0].style.display="none",a("block"),document.getElementById("time__".concat(s)).innerHTML=i.time_start+" - "+i.time_end,document.getElementById("title__".concat(s)).innerHTML=i.title,document.getElementById("desc__".concat(s)).innerHTML=i.desc;break;default:o[0].style.display="none",a("block")}}};return Object.setPrototypeOf(t,e),t}var lesson=Object.create(LessonModule());document.getElementById("submitCreateLesson").addEventListener("click",function(e){e.preventDefault(),lesson.lessonCreate()}),document.getElementById("submitEditLesson").addEventListener("click",function(e){e.preventDefault(),lesson.lessonEdit()});